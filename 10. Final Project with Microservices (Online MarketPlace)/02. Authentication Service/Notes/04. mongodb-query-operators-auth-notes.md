

# ğŸ” MongoDB Query Operators (`$or`, `$and`, `$in`, etc.)

### ğŸ§  In-Depth Notes with Real Backend Examples

---

## ğŸ§© Problem Context (Why We Need Operators)

You used this code:

```js
const isUserAlreadyExists = await userModel.findOne({
  $or: [{ username }, { email }],
});
```

### ğŸ¯ Goal

> Check if **either** the `username` **OR** `email` already exists.

This is where **MongoDB query operators** come in.

---

## ğŸ“˜ What Are MongoDB Query Operators?

> **Query operators** are special MongoDB keywords (starting with `$`)
> used to build **advanced conditions** inside database queries.

ğŸ“Œ They allow:

* Logical conditions
* Comparisons
* Array checks
* Field existence checks

---

## ğŸ”€ `$or` Operator (MOST COMMON)

### ğŸ“Œ Definition

> `$or` matches documents where **ANY ONE** condition is true.

---

### âœ… Syntax

```js
{
  $or: [
    { condition1 },
    { condition2 },
    { condition3 }
  ]
}
```

---

### ğŸ§ª Your Example (Correct Usage)

```js
const user = await userModel.findOne({
  $or: [{ username }, { email }],
});
```

ğŸ§  Meaning:

```txt
Find a user where:
username matches
OR
email matches
```

---

### ğŸ“¦ Equivalent SQL

```sql
SELECT * FROM users
WHERE username = ? OR email = ?
```

---

## â— Common Mistake with `$or`

### âŒ Wrong

```js
$or: { username, email } // âŒ
```

### âœ… Correct

```js
$or: [{ username }, { email }]
```

ğŸ“Œ `$or` **ALWAYS expects an array**

---

## ğŸ”— `$and` Operator

### ğŸ“Œ Definition

> `$and` matches documents where **ALL conditions** are true.

---

### âœ… Example

```js
const user = await userModel.findOne({
  $and: [
    { role: "admin" },
    { isActive: true }
  ]
});
```

ğŸ§  Meaning:

```txt
role must be admin
AND
user must be active
```

---

### ğŸ§  Shortcut (Important)

MongoDB automatically applies `$and` when multiple fields are used:

```js
// SAME AS $and
userModel.findOne({
  role: "admin",
  isActive: true
});
```

---

## ğŸ§® `$in` Operator

### ğŸ“Œ Definition

> `$in` matches if a field equals **ANY value in an array**

---

### âœ… Example

```js
const users = await userModel.find({
  role: { $in: ["admin", "moderator"] }
});
```

ğŸ§  Meaning:

```txt
role is admin OR moderator
```

---

### ğŸ”¥ Use Case

âœ” Role-based access
âœ” Filters
âœ” Multi-value search

---

## ğŸš« `$nin` Operator

### ğŸ“Œ Definition

> `$nin` matches values **NOT in the array**

---

### âœ… Example

```js
userModel.find({
  role: { $nin: ["banned", "deleted"] }
});
```

---

## ğŸ” `$exists` Operator

### ğŸ“Œ Definition

> Checks whether a field **exists or not**

---

### âœ… Example

```js
userModel.find({
  phoneNumber: { $exists: true }
});
```

ğŸ§  Finds users who **have** a phone number

---

## ğŸ“Š Comparison Operators

### `$eq` â€“ equal

```js
{ age: { $eq: 18 } }
```

### `$ne` â€“ not equal

```js
{ status: { $ne: "inactive" } }
```

### `$gt` / `$gte`

```js
{ age: { $gte: 18 } }
```

### `$lt` / `$lte`

```js
{ age: { $lt: 60 } }
```

---

## ğŸ§º Array Operators

### `$size`

```js
userModel.find({
  addresses: { $size: 0 }
});
```

---

### `$all`

```js
userModel.find({
  skills: { $all: ["js", "node"] }
});
```

---

## ğŸ” Auth-Related Real Examples

### âœ… Check Username OR Email (REGISTER)

```js
userModel.findOne({
  $or: [{ username }, { email }]
});
```

---

### âœ… Login with Email or Username

```js
userModel.findOne({
  $or: [
    { email: loginId },
    { username: loginId }
  ]
}).select("+password");
```

---

### âœ… Active Admin Users

```js
userModel.find({
  role: "admin",
  isActive: true
});
```

---

## âš ï¸ Performance & Indexing (INTERVIEW GOLD)

### â— Important Rule

> ğŸ”‘ Fields used inside `$or` should be **indexed**

### âœ… Best Practice

```js
userSchema.index({ username: 1 });
userSchema.index({ email: 1 });
```

---

## ğŸ§  Interview Questions & Answers

### â“ Q: Why does `$or` need an array?

ğŸ‘‰ Because MongoDB evaluates multiple independent conditions.

---

### â“ Q: Difference between `$or` and `$in`?

ğŸ‘‰ `$or` checks **conditions**, `$in` checks **values**

---

### â“ Q: When should `$and` be avoided?

ğŸ‘‰ When simple field matching already implies AND.

---

## ğŸ§¾ Cheat Sheet (Save This)

```js
$or     // any condition true
$and    // all conditions true
$in     // value in array
$nin    // value not in array
$exists // field existence
$gt     // greater than
$lt     // less than
```

---

## ğŸ§  Final Summary

âœ¨ `$or` is essential for auth checks
âœ¨ Always use `findOne()` with `$or`
âœ¨ `$in` is for value matching
âœ¨ Index `$or` fields for performance

---