


# ðŸ“Œ `new: true` in Mongoose â€” Complete Notes

---

## ðŸ”¹ What is `new: true`?

In **Mongoose**,
`new: true` is an **option** used with **update-and-return methods**.

ðŸ‘‰ It tells Mongoose to **return the updated document**, not the old one.

---

## ðŸ”¹ Default Behavior (VERY IMPORTANT âš ï¸)

By default:

```js
new: false
```

This means:

* Database **gets updated**
* Returned document is the **OLD version**

---

## ðŸ”¹ Why `new: true` exists?

MongoDB updates happen **directly in the database**,
but Mongoose must decide **which version to return**:

* ðŸ“„ Old document (before update)
* ðŸ“„ New document (after update)

`new: true` controls this behavior.

---

## ðŸ”¹ Syntax

```js
Model.findOneAndUpdate(filter, update, { new: true })
```

---

## ðŸ”¹ Example 1: Without `new: true` âŒ

```js
const user = await User.findOneAndUpdate(
  { _id: id },
  { name: "John" }
);

console.log(user.name);
```

### Result:

* Database â†’ name updated to **John**
* Returned `user.name` â†’ âŒ **OLD name**

---

## ðŸ”¹ Example 2: With `new: true` âœ…

```js
const user = await User.findOneAndUpdate(
  { _id: id },
  { name: "John" },
  { new: true }
);

console.log(user.name);
```

### Result:

* Database â†’ name updated
* Returned document â†’ âœ… **UPDATED user**

---

## ðŸ”¹ Methods where `new: true` is used

| Method                | Supports `new: true` |
| --------------------- | -------------------- |
| `findOneAndUpdate()`  | âœ…                    |
| `findByIdAndUpdate()` | âœ…                    |
| `findOneAndReplace()` | âœ…                    |

âŒ **Not used with**:

* `updateOne()`
* `updateMany()`

(They donâ€™t return documents)

---

## ðŸ”¹ When SHOULD you use `new: true` âœ…

Use `new: true` when:

âœ” You need to **send updated data in API response**
âœ” You want **immediate updated state**
âœ” You are **updating nested data** (arrays, objects)
âœ” Your **tests expect updated output**

---

## ðŸ”¹ When NOT required âŒ

You can skip `new: true` when:

âŒ You donâ€™t care about the returned document
âŒ You only need to update DB silently
âŒ You are using `updateOne()`

---

## ðŸ”¹ Real-world use cases ðŸŒ

### 1ï¸âƒ£ Updating profile

```js
res.json(updatedUser); // needs updated data
```

### 2ï¸âƒ£ Deleting address (your case)

```js
addresses: updatedUser.addresses
```

### 3ï¸âƒ£ Setting default address

```js
{ $set: { "addresses.$[].isDefault": false } }
```

---

## ðŸ”¹ What happens WITHOUT `new: true` in APIs âŒ

* Client sees **old data**
* Tests fail
* UI shows stale state
* Confusing bugs

---

## ðŸ”¹ Best Practice â­

Always combine:

```js
{ new: true, runValidators: true }
```

âœ” Ensures:

* Updated document returned
* Schema validation applied

---

## ðŸ”¹ Interview-Ready Explanation ðŸŽ¤

> `new: true` tells Mongoose to return the document **after the update** instead of the document **before the update**, which is essential when sending updated data back to the client.

---

## ðŸ”¹ Quick Comparison Table ðŸ§ 

| Option                 | Returned Document |
| ---------------------- | ----------------- |
| `new: false` (default) | OLD document      |
| `new: true`            | UPDATED document  |

---

## ðŸ”¹ One-Line Summary âœ¨

> **`new: true` ensures you work with the latest updated data, not stale data.**

---

## âœ… Final Tip (Very Important)

If you ever see:

* Correct DB update
* Wrong API response

ðŸ‘‰ **First thing to check: `new: true`**

---