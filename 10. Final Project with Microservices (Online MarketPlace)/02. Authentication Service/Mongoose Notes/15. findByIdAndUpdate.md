

# ğŸ› ï¸ `findByIdAndUpdate()` in Mongoose (In-Depth Notes)

`findByIdAndUpdate()` is a **convenience update method** provided by **Mongoose** for working with documents stored in **MongoDB**.

It is essentially a **shortcut for updating a document by its `_id`**.

---

## ğŸ“Œ 1. What Is `findByIdAndUpdate()`?

### âœ… Definition

`findByIdAndUpdate()`:

* Finds **one document by `_id`**
* Updates it using **update operators**
* Returns **the document (old or updated)**

ğŸ“Œ Internally, it behaves like:

```js
findOneAndUpdate({ _id: id }, update, options)
```

---

## â“ 2. Why `findByIdAndUpdate()` Is Needed

### Problem Without It

To update by `_id`, you would otherwise write:

```js
Model.findOneAndUpdate({ _id: id }, update, options);
```

ğŸ‘‰ `findByIdAndUpdate()` makes this **simpler, cleaner, and more readable**.

---

## ğŸ¯ 3. When to Use `findByIdAndUpdate()`

Use `findByIdAndUpdate()` when:

âœ… You already have the documentâ€™s `_id`
âœ… You want to update **exactly one document**
âœ… You want to **return the updated document**
âœ… You are updating:

* User profiles
* Products
* Orders
* Any resource identified by `_id`

ğŸ“Œ Very common in **REST APIs**:

```
PUT /users/:id
PATCH /products/:id
```

---

## ğŸ“ 4. Where Is `findByIdAndUpdate()` Used?

### Mongoose Model Method

```js
Model.findByIdAndUpdate()
```

ğŸ“Œ Typically used inside:

* Controllers
* Services
* API route handlers

---

## ğŸ§± 5. Syntax of `findByIdAndUpdate()`

```js
Model.findByIdAndUpdate(
  id,
  update,
  options
)
```

---

## ğŸ§© 6. Parameters Explained

### ğŸ†” id

* The `_id` of the document
* Can be `ObjectId` or string

```js
"64a9f8c2e123456789abcd01"
```

---

### ğŸ› ï¸ update

* Uses **update operators** (`$set`, `$inc`, `$push`, etc.)
* Prevents full document replacement

```js
{ $set: { age: 30 } }
```

---

### âš™ï¸ options (Very Important)

| Option                | Meaning                      |
| --------------------- | ---------------------------- |
| `new: true`           | Return updated document      |
| `upsert: true`        | Insert if document not found |
| `runValidators: true` | Apply schema validation      |
| `select`              | Choose fields to return      |

ğŸ“Œ Default behavior returns the **old document**.

---

# ğŸ§ª 7. Examples (Schema Before Each Example)

---

## Example 1ï¸âƒ£: Basic Update by ID and Return Updated Document

### ğŸ“„ Mongoose Schema

```js
const UserSchema = new mongoose.Schema({
  name: String,
  age: Number,
  city: String
});
```

### ğŸ§ª Mongoose Query

```js
User.findByIdAndUpdate(
  "64a9f8c2e123456789abcd01",
  { $set: { age: 30 } },
  { new: true }
);
```

### âœ… Explanation

* Finds user by `_id`
* Updates age
* Returns **updated document**

---

## Example 2ï¸âƒ£: Default Behavior (Returns Old Document)

### ğŸ“„ Schema

```js
const UserSchema = new mongoose.Schema({
  email: String,
  isActive: Boolean
});
```

### ğŸ§ª Query

```js
User.findByIdAndUpdate(
  userId,
  { $set: { isActive: true } }
);
```

### âš ï¸ Explanation

* Update is applied
* Returned document is **old version**
* `new: true` is missing

---

## Example 3ï¸âƒ£: Incrementing a Numeric Field

### ğŸ“„ Schema

```js
const AccountSchema = new mongoose.Schema({
  balance: Number
});
```

### ğŸ§ª Query

```js
Account.findByIdAndUpdate(
  accountId,
  { $inc: { balance: 1000 } },
  { new: true }
);
```

### âœ… Explanation

* Atomically increments balance
* Returns updated balance
* Safe for concurrent updates

---

## Example 4ï¸âƒ£: Updating Nested Fields

### ğŸ“„ Schema

```js
const UserSchema = new mongoose.Schema({
  name: String,
  address: {
    city: String,
    pincode: Number
  }
});
```

### ğŸ§ª Query

```js
User.findByIdAndUpdate(
  userId,
  { $set: { "address.city": "Mumbai" } },
  { new: true }
);
```

### âœ… Explanation

* Uses **dot notation**
* Updates nested object safely

---

## Example 5ï¸âƒ£: Using `upsert` Option

### ğŸ“„ Schema

```js
const ProductSchema = new mongoose.Schema({
  item: String,
  price: Number
});
```

### ğŸ§ª Query

```js
Product.findByIdAndUpdate(
  productId,
  { $set: { price: 50 } },
  { upsert: true, new: true }
);
```

### âœ… Explanation

* If document exists â†’ update
* If not â†’ insert new document
* Returns inserted document

---

## Example 6ï¸âƒ£: Enforcing Schema Validation

### ğŸ“„ Schema

```js
const UserSchema = new mongoose.Schema({
  name: { type: String, required: true },
  age: { type: Number, min: 18 }
});
```

### ğŸ§ª Query

```js
User.findByIdAndUpdate(
  userId,
  { $set: { age: 16 } },
  { new: true, runValidators: true }
);
```

### âš ï¸ Explanation

* Validation runs because `runValidators: true`
* Without it â†’ invalid data could be saved

---

## ğŸ“¦ 8. What Does `findByIdAndUpdate()` Return?

### ğŸ“¤ Return Value

* Returns **one document**
* Can be:

  * Old document (default)
  * Updated document (`new: true`)
* Returns `null` if:

  * No document found
  * `upsert` is not used

---

### ğŸ“Š Return Summary

| Case           | Return            |
| -------------- | ----------------- |
| `new: false`   | Old document      |
| `new: true`    | Updated document  |
| No match       | `null`            |
| Upsert enabled | Inserted document |

---

## âš ï¸ 9. Important Rules & Best Practices

âœ… Always use update operators (`$set`, `$inc`)
âœ… Almost always use `{ new: true }`
âœ… Use `{ runValidators: true }` for safety
âŒ Do not use for bulk updates
ğŸ“Œ Prefer over `findOneAndUpdate()` when `_id` is available

---

## ğŸ”„ 10. Comparison with Related Methods

| Method                | Filter     | Returns Doc |
| --------------------- | ---------- | ----------- |
| `updateOne()`         | Any        | âŒ No        |
| `findOneAndUpdate()`  | Any        | âœ… Yes       |
| `findByIdAndUpdate()` | `_id` only | âœ… Yes       |

---

## ğŸ“ 11. Key Exam & Interview Points

* `findByIdAndUpdate()` updates **one document by `_id`**
* Shortcut for `findOneAndUpdate({ _id })`
* Returns **old or updated document**
* Very common in REST APIs
* Requires `new: true` to get updated data

---
