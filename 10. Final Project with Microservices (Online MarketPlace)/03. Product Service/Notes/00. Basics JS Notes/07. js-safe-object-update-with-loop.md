


# ğŸ“˜ JavaScript Basics: Updating Objects Safely Using Loops & Conditions

---

## ğŸ“Œ Complete Code (Reference Example)

```js
const allowedUpdates = ["title", "description", "price"];

// Update only allowed fields from request body
for (const key of Object.keys(req.body)) {
  if (allowedUpdates.includes(key)) {

    // Special handling for PRICE since it is a nested OBJECT
    // Example: price: { amount: 20, currency: "INR" }
    if (key === "price" && typeof req.body.price === "object") {

      // Update price amount if provided
      if (req.body.price.amount !== undefined) {
        product.price.amount = Number(req.body.price.amount);
      }

      // Update price currency if provided
      if (req.body.price.currency !== undefined) {
        product.price.currency = req.body.price.currency;
      }

    } else {
      // Update simple (non-nested) fields like title or description
      product[key] = req.body[key];
    }
  }
}
```

---

## ğŸ§  What Problem Are We Solving?

We want to:

* Update an object (`product`)
* Using data from another object (`req.body`)
* **Safely**, without allowing unwanted changes
* And handle **nested objects correctly**

This teaches many **core JavaScript concepts**:

* Objects
* Arrays
* Loops
* Dynamic property access
* Conditions
* Partial updates

---

## 1ï¸âƒ£ Understanding the Data Structures (Basics First)

### Example `product` Object

```js
const product = {
  title: "Phone",
  description: "Smart phone",
  price: {
    amount: 1000,
    currency: "INR"
  }
};
```

### Example `req.body` (User Input)

```js
const req = {
  body: {
    title: "New Phone",
    price: {
      amount: 1200
    }
  }
};
```

---

## 2ï¸âƒ£ Allowed Updates (Whitelisting Concept)

```js
const allowedUpdates = ["title", "description", "price"];
```

### Why is this needed?

* Prevents updating unwanted fields
* Example of fields NOT allowed:

  * `_id`
  * `seller`
  * `createdAt`

ğŸ§  **JS Concept:** Array + `includes()`

```js
allowedUpdates.includes("title"); // true
allowedUpdates.includes("seller"); // false
```

---

## 3ï¸âƒ£ Looping Through Object Keys ğŸ”

```js
Object.keys(req.body)
```

### Example:

```js
Object.keys({ title: "A", price: {} });
// ["title", "price"]
```

### Loop:

```js
for (const key of Object.keys(req.body)) {
```

* `key` becomes `"title"`, then `"price"`
* This is **dynamic iteration** (very important JS concept)

---

## 4ï¸âƒ£ Checking If a Field Is Allowed âœ…

```js
if (allowedUpdates.includes(key)) {
```

### Meaning:

* Only process keys that are safe
* Others are ignored automatically

ğŸ§  This is **defensive programming** in JavaScript

---

## 5ï¸âƒ£ Special Case: Nested Object (`price`) ğŸ§©

### Why special handling?

Because:

```js
price = {
  amount: Number,
  currency: String
}
```

You **cannot** safely overwrite it like this:

```js
product.price = req.body.price; // âŒ dangerous
```

This might remove existing properties.

---

## 6ï¸âƒ£ Checking for Object Type (JS Basics)

```js
typeof req.body.price === "object"
```

Why?

* Ensures `price` is not:

  * number
  * string
  * null

ğŸ§  **JS Fact:**

```js
typeof {} === "object"
typeof [] === "object"
```

---

## 7ï¸âƒ£ Partial Updates (VERY IMPORTANT JS CONCEPT)

```js
if (req.body.price.amount !== undefined) {
```

### Why not check `if (req.body.price.amount)`?

Because:

```js
amount = 0; // valid value
```

âœ” `!== undefined` allows `0`
âŒ `if (amount)` would skip it

---

## 8ï¸âƒ£ Updating Nested Properties Safely ğŸ”

```js
product.price.amount = Number(req.body.price.amount);
```

* Converts string â†’ number
* Updates only what is provided
* Keeps remaining data unchanged

---

## 9ï¸âƒ£ Updating Simple (Non-Nested) Fields âœï¸

```js
product[key] = req.body[key];
```

### Why bracket notation?

Because `key` is a variable:

```js
product["title"] = "New Phone";
```

ğŸ§  **JS Rule:**

* Use `.` â†’ fixed property
* Use `[]` â†’ dynamic property

---

## ğŸ” Complete Example (Step-by-Step)

### Input

```js
req.body = {
  title: "New Phone",
  price: { amount: 1200 }
};
```

### Output

```js
product = {
  title: "New Phone",
  description: "Smart phone",
  price: {
    amount: 1200,
    currency: "INR"
  }
};
```

âœ” Only allowed fields updated
âœ” Nested object preserved
âœ” Partial update supported

---

## ğŸ¯ Interview-Ready Explanation (Impressive)

> â€œI iterate over request body keys, validate them against a whitelist, handle nested objects like `price` separately to allow partial updates, and use dynamic property access to safely update the target object.â€

### Bonus Line (Very Impressive):

> â€œThis pattern prevents mass assignment vulnerabilities and ensures safe object mutation in JavaScript.â€

---

## ğŸ§  Key JavaScript Concepts Covered (Revision)

âœ… Objects & nested objects
âœ… Arrays & `includes()`
âœ… `Object.keys()`
âœ… `for...of` loop
âœ… Dynamic property access
âœ… Partial updates
âœ… Type checking
âœ… Defensive programming

---