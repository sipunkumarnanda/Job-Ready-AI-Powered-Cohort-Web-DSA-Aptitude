
```js
const mongoose = require("mongoose");

const productSchema = new mongoose.Schema({
  title: {
    type: String,
    required: true,
  },
  description: {
    type: String,
    required: true,
  },
  price: {
    amount: {
      type: Number,
      required: true,
    },
    currency: {
      type: String,
      enum: ["USD", "INR"],
      default: "INR",
    },
  },
  seller: {
    type: mongoose.Schema.ObjectId,
    required: true,
  },
  images: [
    {
      url: String,
      thumbnail: String,
      id: String,
    },
  ]
});

const productModel = mongoose.model("products", productSchema);

module.exports = productModel;

```

---

# ğŸ›’ Product Schema in Mongoose â€” Detailed Explanation

This schema defines the **structure of a Product document** stored in **MongoDB** using **Mongoose**. It ensures **data consistency, validation, and organization** for product-related data in a Node.js application.

---

## ğŸ“¦ 1. Importing Mongoose

```js
const mongoose = require("mongoose");
```

### ğŸ”¹ What this does:

* Imports the **Mongoose library**
* Allows interaction with MongoDB using schemas and models
* Provides built-in **validation, middleware, and schema-based modeling**

---

## ğŸ§© 2. Creating the Product Schema

```js
const productSchema = new mongoose.Schema({
  ...
});
```

### ğŸ”¹ Purpose:

* Defines **how a product document should look**
* Controls **data types, required fields, defaults, and constraints**

---

## ğŸ“ 3. Product Fields Explained

---

### ğŸ·ï¸ Title Field

```js
title: {
  type: String,
  required: true,
},
```

ğŸ”¹ **Description:**

* Stores the **name/title** of the product
* Must be a **string**
* **Required** â†’ MongoDB will reject documents without this field

âœ… Example:

```json
"title": "Wireless Mouse"
```

---

### ğŸ§¾ Description Field

```js
description: {
  type: String,
  required: true,
},
```

ğŸ”¹ **Description:**

* Stores **detailed information** about the product
* Required to ensure clarity for buyers

âœ… Example:

```json
"description": "Ergonomic wireless mouse with long battery life"
```

---

### ğŸ’° Price Object (Nested Field)

```js
price: {
  amount: {
    type: Number,
    required: true,
  },
  currency: {
    type: String,
    enum: ["USD", "INR"],
    default: "INR",
  },
},
```

#### ğŸ”¹ Why nested?

* Groups price-related data logically
* Makes schema **scalable** (e.g., adding discounts later)

---

#### ğŸ’µ amount

* Numeric value of the product price
* **Required**

âœ… Example:

```json
"amount": 999
```

---

#### ğŸŒ currency

* String value representing currency
* Limited using `enum` â†’ only `"USD"` or `"INR"`
* Defaults to `"INR"` if not provided

âœ… Example:

```json
"currency": "USD"
```

ğŸš« Invalid values like `"EURO"` will throw an error

---

### ğŸ‘¤ Seller Field (Reference ID)

```js
seller: {
  type: mongoose.Schema.ObjectId,
  required: true,
},
```

ğŸ”¹ **Description:**

* Stores the **ObjectId of the seller**
* Typically references a **User document**
* Required to track **who owns or listed the product**

âœ… Example:

```json
"seller": "64a8f9c2e8a1c9b7a1234567"
```

ğŸ’¡ Often used with `.populate()` to fetch seller details

---

### ğŸ–¼ï¸ Images Array

```js
images: [
  {
    url: String,
    thumbnail: String,
    id: String,
  },
]
```

ğŸ”¹ **Description:**

* Stores **multiple images per product**
* Each image is an object with metadata

---

#### ğŸ“¸ Image Fields

| Field       | Purpose                                |
| ----------- | -------------------------------------- |
| `url`       | Full-size image URL                    |
| `thumbnail` | Smaller preview image                  |
| `id`        | Image identifier (e.g., Cloudinary ID) |

âœ… Example:

```json
"images": [
  {
    "url": "https://cdn.site.com/product1.jpg",
    "thumbnail": "https://cdn.site.com/thumb1.jpg",
    "id": "img_12345"
  }
]
```

---

## ğŸ—ï¸ 4. Creating the Model

```js
const productModel = mongoose.model("products", productSchema);
```

ğŸ”¹ **What this does:**

* Converts schema into a **MongoDB collection**
* Collection name: `products`
* Enables database operations like:

  * `create()`
  * `find()`
  * `updateOne()`
  * `deleteOne()`

---

## ğŸ“¤ 5. Exporting the Model

```js
module.exports = productModel;
```

ğŸ”¹ Makes the model reusable across:

* Controllers
* Services
* Routes

---

## âœ… Summary of Key Features

âœ¨ **Strong validation** using `required` and `enum`
âœ¨ **Nested objects** for clean data modeling
âœ¨ **Scalable structure** for future enhancements
âœ¨ **Supports multiple images**
âœ¨ **Seller ownership tracking**

---

## ğŸš€ Suggested Improvements (Optional)

ğŸ”§ Add timestamps:

```js
{ timestamps: true }
```

ğŸ”§ Add index for search:

```js
title: { type: String, index: true }
```

ğŸ”§ Reference seller model:

```js
seller: { type: mongoose.Schema.ObjectId, ref: "User" }
```

---



# ğŸ‘¤ Seller Field in Mongoose (Reference ID) â€” In-Depth Explanation

```js
seller: {
  type: mongoose.Schema.ObjectId,
  required: true,
},
```

This field is used to **link a product to the user (seller) who created or owns it**.
It establishes a **relationship between two collections** in MongoDB.

---

## ğŸ”— 1. What is `ObjectId`?

### ğŸ“Œ Definition

`ObjectId` is a **unique 12-byte identifier** automatically generated by MongoDB.

ğŸ”¹ Example:

```json
"64a8f9c2e8a1c9b7a1234567"
```

### ğŸ§  What it contains internally:

* Timestamp â±ï¸
* Machine identifier ğŸ’»
* Process ID ğŸ”¢
* Counter â™»ï¸

â¡ï¸ This guarantees **global uniqueness**.

---

## ğŸ§© 2. Why Use `mongoose.Schema.ObjectId`?

```js
type: mongoose.Schema.ObjectId
```

### ğŸ”¹ Purpose:

* Tells Mongoose that this field stores **a reference to another document**
* Enables **relationship mapping** between collections

### ğŸ“¦ In this case:

* `seller` â†’ points to a **User document**
* Product and User remain in **separate collections**
* Avoids data duplication âŒ

---

## ğŸ‘¥ 3. Relationship Type (One-to-Many)

This design represents:

### ğŸ—ï¸ **One User â†’ Many Products**

```text
User (Seller)
   â”œâ”€â”€ Product A
   â”œâ”€â”€ Product B
   â””â”€â”€ Product C
```

ğŸ”¹ A seller can list **multiple products**
ğŸ”¹ Each product belongs to **one seller**

---

## ğŸ”’ 4. Why `required: true`?

```js
required: true
```

### âœ… Ensures:

* Every product **must have an owner**
* No orphan products in the database
* Better security & accountability

âŒ Without this:

* Products could exist without knowing **who created them**

---

## ğŸ§  5. Referencing a User Document

### â— Current schema:

```js
seller: {
  type: mongoose.Schema.ObjectId,
  required: true,
}
```

### ğŸ”¹ Improved (Recommended):

```js
seller: {
  type: mongoose.Schema.ObjectId,
  ref: "User",
  required: true,
}
```

ğŸ§  `ref: "User"` tells Mongoose:

> â€œThis ObjectId belongs to the **User** collectionâ€

---

## ğŸ”„ 6. How `.populate()` Works

### ğŸ§ª Without `.populate()`

```js
Product.findById(id)
```

ğŸ“¤ Output:

```json
{
  "title": "Laptop",
  "seller": "64a8f9c2e8a1c9b7a1234567"
}
```

â¡ï¸ You only get the **seller ID**, not user details.

---

### âœ¨ With `.populate()`

```js
Product.findById(id).populate("seller");
```

ğŸ“¤ Output:

```json
{
  "title": "Laptop",
  "seller": {
    "_id": "64a8f9c2e8a1c9b7a1234567",
    "name": "Rahul Sharma",
    "email": "rahul@gmail.com"
  }
}
```

ğŸ‰ Mongoose **automatically replaces the ObjectId** with the full user document.

---

## ğŸ¯ 7. Selective Population (Best Practice)

```js
.populate("seller", "name email")
```

### âœ… Benefits:

* Fetches only required fields
* Improves performance âš¡
* Avoids leaking sensitive data (passwords âŒ)

ğŸ“¤ Output:

```json
"seller": {
  "name": "Rahul Sharma",
  "email": "rahul@gmail.com"
}
```

---

## ğŸ›¡ï¸ 8. Security & Authorization Use-Cases

The seller field is critical for **access control** ğŸ”

### ğŸ§ª Example: Only seller can update product

```js
if (product.seller.toString() !== req.user._id.toString()) {
  return res.status(403).json({ message: "Unauthorized" });
}
```

âœ… Prevents:

* Unauthorized edits
* Product hijacking

---

## âš–ï¸ 9. Why Reference Instead of Embedding?

### âŒ Embedding Seller Data (Bad)

```json
{
  "sellerName": "Rahul",
  "sellerEmail": "rahul@gmail.com"
}
```

ğŸš« Problems:

* Data duplication
* Updates needed everywhere
* Inconsistent data

---

### âœ… Referencing (Best Practice)

```json
"seller": "64a8f9c2e8a1c9b7a1234567"
```

âœ” Clean
âœ” Scalable
âœ” Easy updates
âœ” Professional schema design

---

## ğŸ“Œ 10. Real-World Analogy ğŸª

Think of this like:

ğŸ›’ **Amazon Product**

* Product = Item listing
* Seller ID = Store owner ID
* `.populate()` = Opening seller profile

---

## ğŸ§  Final Summary ğŸ“

âœ¨ `seller` stores a **reference (ObjectId)** to a User
âœ¨ Enables **relationships** between collections
âœ¨ `.populate()` fetches full seller details
âœ¨ Critical for **security, ownership & scalability**
âœ¨ Follows **industry-standard database design**

---