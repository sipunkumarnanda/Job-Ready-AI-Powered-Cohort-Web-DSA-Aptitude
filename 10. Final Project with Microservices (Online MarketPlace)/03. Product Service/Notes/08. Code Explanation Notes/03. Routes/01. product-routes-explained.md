


# ğŸ›’ Product Routes â€“ Detailed Explanation Notes

---

## ğŸ“Œ Complete Product Routes Code (At One Place)

```js
const express = require('express');
const router = express.Router();
const multer = require('multer');

const createAuthMiddleware = require('../middleware/auth.middleware.js');
const productController = require('../controller/product.controller.js');
const productValidators = require('../validators/product.validator.js');

const upload = multer({
  storage: multer.memoryStorage()
});

// POST  /api/products/
router.post(
  '/',
  createAuthMiddleware(['admin', 'seller']),
  upload.array('images', 5),
  productValidators.createProductValidators,
  productController.createProduct
);

// GET /api/products
router.get('/', productController.getProducts);

// GET /api/products/:id
router.get('/:id', productController.getProductById);

// PATCH /api/products/:id
router.patch(
  '/:id',
  createAuthMiddleware(['seller']),
  productController.updateProduct
);

module.exports = router;
```

---

## ğŸ§  What Are Product Routes?

Product routes define **all HTTP endpoints** related to products, such as:

* Creating a product
* Fetching all products
* Fetching a product by ID
* Updating a product

They act as the **entry point** for product-related API requests.

---

## 1ï¸âƒ£ Router Setup (Express Basics) ğŸš¦

```js
const express = require('express');
const router = express.Router();
```

* Creates a modular router using Express
* Keeps routes organized and clean
* Mounted later like:

```js
app.use('/api/products', router);
```

---

## 2ï¸âƒ£ Importing Dependencies ğŸ“¦

```js
const multer = require('multer');
const createAuthMiddleware = require('../middleware/auth.middleware.js');
const productController = require('../controller/product.controller.js');
const productValidators = require('../validators/product.validator.js');
```

### Purpose of each:

* **multer** â†’ handles file uploads
* **auth middleware** â†’ authentication & authorization
* **controller** â†’ business logic
* **validators** â†’ request data validation

---

## 3ï¸âƒ£ Multer Configuration (Image Uploads) ğŸ–¼ï¸

```js
const upload = multer({
  storage: multer.memoryStorage()
});
```

### What this means:

* Files are stored in memory as `Buffer`
* Useful when:

  * Uploading to cloud storage (ImageKit, S3)
  * Not saving files locally

ğŸ“Œ Uploaded files are available at:

```js
req.files
```

---

## 4ï¸âƒ£ POST `/api/products/` â€“ Create Product â•

```js
router.post(
  '/',
  createAuthMiddleware(['admin', 'seller']),
  upload.array('images', 5),
  productValidators.createProductValidators,
  productController.createProduct
);
```

### Middleware Execution Order (Very Important):

1ï¸âƒ£ **Auth Middleware**

```js
createAuthMiddleware(['admin', 'seller'])
```

* Only `admin` or `seller` can create products

2ï¸âƒ£ **File Upload**

```js
upload.array('images', 5)
```

* Accepts up to 5 images
* Field name: `images`

3ï¸âƒ£ **Validation**

```js
productValidators.createProductValidators
```

* Validates request body (title, price, etc.)

4ï¸âƒ£ **Controller**

```js
productController.createProduct
```

* Saves product & images

---

## 5ï¸âƒ£ GET `/api/products` â€“ Fetch All Products ğŸ“¦

```js
router.get('/', productController.getProducts);
```

### Purpose:

* Fetches all products
* Supports:

  * search
  * price filtering
  * pagination

### Access:

* Public route
* No authentication required

---

## 6ï¸âƒ£ GET `/api/products/:id` â€“ Fetch Product by ID ğŸ”

```js
router.get('/:id', productController.getProductById);
```

### Purpose:

* Fetch single product using MongoDB ID
* Validates ID inside controller

### Access:

* Public route

---

## 7ï¸âƒ£ PATCH `/api/products/:id` â€“ Update Product âœï¸

```js
router.patch(
  '/:id',
  createAuthMiddleware(['seller']),
  productController.updateProduct
);
```

### What happens:

1ï¸âƒ£ User must be authenticated
2ï¸âƒ£ User must have role `seller`
3ï¸âƒ£ Controller checks:

* Product exists
* User owns the product

ğŸ“Œ Only product owner can update it

---

## ğŸ” Request Flow Diagram

```txt
Client Request
   â†“
Auth Middleware (if required)
   â†“
File Upload Middleware (if any)
   â†“
Validation Middleware
   â†“
Controller
   â†“
Response
```

---

## ğŸ§  RESTful API Design Principles Used

| HTTP Method | Purpose         |
| ----------- | --------------- |
| POST        | Create resource |
| GET         | Read resource   |
| PATCH       | Update resource |

âœ” Follows REST standards
âœ” Clear and predictable URLs

---

## ğŸ¯ Interview-Ready Explanation (Impressive)

> â€œProduct routes are defined using Express Router and follow RESTful principles. Middleware is composed in a clear order to handle authentication, file uploads, validation, and business logic. Role-based access control ensures secure product creation and updates.â€

### Bonus Line (Very Impressive):

> â€œUsing middleware composition keeps the code modular, scalable, and easy to maintain.â€

---

## ğŸ§  Key Takeaways (For Revision)

âœ… Express Router for modular APIs
âœ… Middleware chaining
âœ… Role-based authorization
âœ… Multer for file uploads
âœ… RESTful route design
âœ… Clean separation of concerns

---