


# ğŸ›’ Create Product API â€“ Explanation Notes

---

## ğŸ“Œ Complete Code (At One Place)

```js
async function createProduct(req, res) {
  try {
    const { title, description, priceAmount, priceCurrency = "INR" } = req.body;
    const seller = req.user.id; // Extract seller from authenticated user

    const price = {
      amount: Number(priceAmount),
      currency: priceCurrency,
    };

    const files = req.files;

    const images = await Promise.all(
      files.map((file) => {
        return uploadImage({ buffer: file.buffer });
      })
    );

    const product = await productModel.create({
      title,
      description,
      price,
      seller,
      images,
    });

    return res.status(201).json({
      message: "Product created",
      data: product,
    });

  } catch (error) {
    console.error("Error occured in create product ", error);
    return res.status(500).json({
      message: "Internal server error",
    });
  }
}
```

---

## ğŸ§  Module-wise Explanation

---

## 1ï¸âƒ£ Async Function Definition ğŸš€

```js
async function createProduct(req, res)
```

* This is an **Express controller function**
* Marked `async` because it uses:

  * image uploads
  * database operations
* Allows usage of `await` for cleaner async handling

---

## 2ï¸âƒ£ Tryâ€“Catch Block (Error Safety) ğŸ›¡ï¸

```js
try {
  ...
} catch (error) {
  ...
}
```

* Prevents server crashes
* Handles:

  * upload failures
  * database errors
* Ensures API always returns a proper response

---

## 3ï¸âƒ£ Extracting Data from Request Body ğŸ“¥

```js
const { title, description, priceAmount, priceCurrency = "INR" } = req.body;
```

* Destructures product details sent by client
* Uses **default value** `"INR"` if currency is not provided
* Makes code clean and readable

---

## 4ï¸âƒ£ Getting Seller from Authenticated User ğŸ‘¤

```js
const seller = req.user.id;
```

* `req.user` is set by authentication middleware (JWT, session, etc.)
* Ensures:

  * product is linked to the logged-in user
  * no fake seller IDs from client

---

## 5ï¸âƒ£ Creating a Price Object ğŸ’°

```js
const price = {
  amount: Number(priceAmount),
  currency: priceCurrency,
};
```

* Converts price to `Number` (important for DB consistency)
* Groups amount and currency into a structured object
* Helpful for multi-currency support

---

## 6ï¸âƒ£ Accessing Uploaded Files ğŸ“‚

```js
const files = req.files;
```

* `req.files` comes from middleware like **Multer**
* Contains:

  * image buffers
  * metadata (name, size, type)

---

## 7ï¸âƒ£ Uploading Images in Parallel ğŸ–¼ï¸âš¡

```js
const images = await Promise.all(
  files.map((file) => {
    return uploadImage({ buffer: file.buffer });
  })
);
```

### Whatâ€™s happening here:

* `files.map()` â†’ creates upload promises
* `uploadImage()` â†’ uploads image to ImageKit
* `Promise.all()` â†’ uploads **all images in parallel**
* `await` â†’ waits until all uploads finish

### Result:

```js
images = [
  { url, thumbnail, imageId },
  { url, thumbnail, imageId }
]
```

âœ… Fast
âœ… Efficient
âœ… Best practice

---

## 8ï¸âƒ£ Creating Product in Database ğŸ—„ï¸

```js
const product = await productModel.create({
  title,
  description,
  price,
  seller,
  images,
});
```

* Saves product details in database (MongoDB / Mongoose)
* Includes:

  * product info
  * seller reference
  * uploaded image URLs

---

## 9ï¸âƒ£ Sending Success Response ğŸ“¤âœ…

```js
return res.status(201).json({
  message: "Product created",
  data: product,
});
```

* `201 Created` â†’ correct HTTP status
* Returns:

  * success message
  * newly created product data

---

## ğŸ”Ÿ Error Handling Response âŒ

```js
catch (error) {
  console.error("Error occured in create product ", error);
  return res.status(500).json({
    message: "Internal server error",
  });
}
```

* Logs error for debugging
* Sends safe error message to client
* Prevents leaking internal details

---

## ğŸ¯ Key Takeaways (Interview Notes)

âœ… Uses `async/await` correctly
âœ… Uploads images in parallel using `Promise.all`
âœ… Clean separation of concerns
âœ… Production-ready error handling
âœ… Secure seller identification

---