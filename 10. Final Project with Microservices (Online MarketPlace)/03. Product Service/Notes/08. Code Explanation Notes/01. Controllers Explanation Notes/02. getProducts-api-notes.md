


# ğŸ“¦ Get Products API â€“ Explanation Notes

---

## ğŸ“Œ Complete Code (At One Place)

```js
async function getProducts(req, res) {
  const { q, minprice, maxprice, skip = 0, limit = 20 } = req.query;

  const filter = {};

  if (q) {
    filter.$text = { $search: q };
  }

  if (minprice) {
    filter["price.amount"] = {
      ...filter["price.amount"],
      $gte: Number(minprice),
    };
  }

  if (maxprice) {
    filter["price.amount"] = {
      ...filter["price.amount"],
      $lte: Number(maxprice),
    };
  }

  try {
    const products = await productModel
      .find(filter)
      .skip(Number(skip))
      .limit(Math.min(Number(limit), 20));

    return res.status(200).json({
      message: "Products fetch successfully",
      data: products,
    });
  } catch (error) {
    console.error("Error occurred in getProduct:", error);
    return res.status(500).json({
      message: "Internal server error",
    });
  }
}
```

---

## ğŸ§  Module-wise Explanation

---

## 1ï¸âƒ£ Async Function Definition ğŸš€

```js
async function getProducts(req, res)
```

* Express **controller function**
* Marked `async` to handle:

  * database queries
  * async pagination
* Allows clean use of `await`

---

## 2ï¸âƒ£ Extracting Query Parameters ğŸ”

```js
const { q, minprice, maxprice, skip = 0, limit = 20 } = req.query;
```

### Purpose:

* Reads filter & pagination data from URL

### Meaning:

* `q` â†’ search keyword
* `minprice` â†’ minimum price filter
* `maxprice` â†’ maximum price filter
* `skip` â†’ pagination offset (default `0`)
* `limit` â†’ number of products (default `20`)

âœ… Default values prevent errors if params are missing

---

## 3ï¸âƒ£ Initializing Filter Object ğŸ§©

```js
const filter = {};
```

* Empty object to dynamically build MongoDB query
* Conditions are added **only if needed**
* Keeps query flexible and clean

---

## 4ï¸âƒ£ Text Search Filter (Search by Keyword) ğŸ“

```js
if (q) {
  filter.$text = { $search: q };
}
```

* Enables **full-text search** in MongoDB
* Requires a text index on fields like:

  * title
  * description

ğŸ“Œ Example:

```
/products?q=iphone
```

---

## 5ï¸âƒ£ Minimum Price Filter ğŸ’°â¬‡ï¸

```js
if (minprice) {
  filter["price.amount"] = {
    ...filter["price.amount"],
    $gte: Number(minprice),
  };
}
```

### What it does:

* `$gte` â†’ greater than or equal to
* Converts `minprice` to `Number`
* Uses spread operator to avoid overwriting other price conditions

ğŸ“Œ Example:

```
/products?minprice=500
```

---

## 6ï¸âƒ£ Maximum Price Filter ğŸ’°â¬†ï¸

```js
if (maxprice) {
  filter["price.amount"] = {
    ...filter["price.amount"],
    $lte: Number(maxprice),
  };
}
```

### What it does:

* `$lte` â†’ less than or equal to
* Works together with `$gte` for price range filtering

ğŸ“Œ Example:

```
/products?minprice=500&maxprice=2000
```

---

## 7ï¸âƒ£ Database Query with Pagination ğŸ—„ï¸ğŸ“„

```js
const products = await productModel
  .find(filter)
  .skip(Number(skip))
  .limit(Math.min(Number(limit), 20));
```

### Explanation:

* `.find(filter)` â†’ fetch products using dynamic filters
* `.skip()` â†’ skips records (pagination)
* `.limit()` â†’ restricts number of results
* `Math.min(limit, 20)` â†’ prevents large data fetch (API protection)

ğŸ“Œ Example:

```
/products?skip=20&limit=10
```

---

## 8ï¸âƒ£ Success Response ğŸ“¤âœ…

```js
return res.status(200).json({
  message: "Products fetch successfully",
  data: products,
});
```

* `200 OK` â†’ successful fetch
* Returns:

  * message
  * array of products

---

## 9ï¸âƒ£ Error Handling ğŸ›‘

```js
catch (error) {
  console.error("Error occurred in getProduct:", error);
  return res.status(500).json({
    message: "Internal server error",
  });
}
```

* Logs error for debugging
* Sends generic error message to client
* Prevents server crash

---

## ğŸ¯ Key Takeaways (Interview Ready)

âœ… Dynamic MongoDB filtering
âœ… Full-text search support
âœ… Price range filtering
âœ… Pagination using skip & limit
âœ… API protection with max limit
âœ… Clean async/await usage

---