


## ğŸ“Œ Express Validator â€“ Product Validation Middleware (Detailed Notes)

---

### ğŸ§© Complete Code (As-Is)

```js
const { body, validationResult } = require('express-validator')

function handleValidationErrors(req, res, next){
    const errors = validationResult(req)
    if(!errors.isEmpty()){
        return res.status(400).json({
            message : "Validation error", errors
        })
    }
    next()
}

const createProductValidators = [
    body("title")
    .trim()
    .isString()
    .withMessage("title must be string")
    .notEmpty()
    .withMessage("title is required"),
 
    body("description")
    .optional()
    .isString()
    .trim()
    .withMessage("description must be string")
    .isLength({ max:500 })
    .withMessage("description length must be 500 characters"),

    body("priceAmount")
    .notEmpty()
    .withMessage("priceAmount is required")
    .bail()
    .isFloat({ gt:0 })
    .withMessage("priceAmount must be a number > 0"),

    body("priceCurrency")
    .optional()
    .isIn([ 'USD', 'INR' ])
    .withMessage("priceCurrency must be USD or INR"),

    handleValidationErrors
]

const getProductValidators = [
    body("productId")
    .isString()
    .withMessage("ProductId must be string")
    .notEmpty()
    .withMessage("productId must be required")
    .isMongoId()
    .withMessage("productId must be a 24 valid 24 character hex mongodb ObjectId"),

    handleValidationErrors
]

module.exports = {
    createProductValidators,
    getProductValidators
}
```

---

## ğŸ§  In-Depth Explanation (Module by Module)

---

## 1ï¸âƒ£ Importing `express-validator` ğŸ§ª

```js
const { body, validationResult } = require('express-validator')
```

### ğŸ” What this does:

* **`body()`** â†’ Used to validate fields coming from `req.body`
* **`validationResult()`** â†’ Collects all validation errors after checks run

ğŸ“Œ This library helps validate and sanitize incoming request data before it reaches your controller.

---

## 2ï¸âƒ£ `handleValidationErrors` Middleware ğŸš¨

```js
function handleValidationErrors(req, res, next){
    const errors = validationResult(req)
    if(!errors.isEmpty()){
        return res.status(400).json({
            message : "Validation error", errors
        })
    }
    next()
}
```

### ğŸ” Purpose:

* Collects validation errors
* Stops request execution if errors exist
* Sends structured error response

### ğŸ§  Flow:

1. `validationResult(req)` extracts validation results
2. `errors.isEmpty()` checks if validation failed
3. If failed:

   * Responds with **400 Bad Request**
   * Sends error details
4. If no errors:

   * Calls `next()` â†’ controller runs

âœ… This keeps your controllers **clean and safe**

---

## 3ï¸âƒ£ `createProductValidators` ğŸ›’

Validation rules for **creating a product**

```js
const createProductValidators = [ ... ]
```

This is an **array of middleware functions** executed in order.

---

### ğŸŸ¢ `title` Validation

```js
body("title")
.trim()
.isString()
.withMessage("title must be string")
.notEmpty()
.withMessage("title is required")
```

ğŸ” Explanation:

* `trim()` â†’ Removes extra spaces
* `isString()` â†’ Ensures text input
* `notEmpty()` â†’ Field must not be empty

âŒ Rejects:

* Numbers
* Empty string
* Missing title

---

### ğŸŸ¡ `description` Validation (Optional)

```js
body("description")
.optional()
.isString()
.trim()
.withMessage("description must be string")
.isLength({ max:500 })
.withMessage("description length must be 500 characters")
```

ğŸ” Explanation:

* `optional()` â†’ Field is **not required**
* If provided:

  * Must be string
  * Max length 500 characters

ğŸ“Œ Useful for product descriptions

---

### ğŸ”µ `priceAmount` Validation ğŸ’°

```js
body("priceAmount")
.notEmpty()
.withMessage("priceAmount is required")
.bail()
.isFloat({ gt:0 })
.withMessage("priceAmount must be a number > 0")
```

ğŸ” Explanation:

* `notEmpty()` â†’ Required field
* `bail()` â†’ Stops further checks if previous fails
* `isFloat({ gt: 0 })` â†’ Must be a number greater than 0

ğŸ“Œ Prevents:

* Negative prices
* Zero
* Non-numeric values

---

### ğŸŸ£ `priceCurrency` Validation ğŸŒ

```js
body("priceCurrency")
.optional()
.isIn([ 'USD', 'INR' ])
.withMessage("priceCurrency must be USD or INR")
```

ğŸ” Explanation:

* Optional field
* Must be one of the allowed values

ğŸ“Œ Enforces strict currency control

---

### ğŸ§© `handleValidationErrors`

```js
handleValidationErrors
```

ğŸ” This ensures:

* All above validations are checked
* Errors are returned immediately
* Controller executes **only if data is valid**

---

## 4ï¸âƒ£ `getProductValidators` ğŸ”

Validation for fetching a product by ID

---

### ğŸŸ  `productId` Validation

```js
body("productId")
.isString()
.withMessage("ProductId must be string")
.notEmpty()
.withMessage("productId must be required")
.isMongoId()
.withMessage("productId must be a 24 valid 24 character hex mongodb ObjectId")
```

ğŸ” Explanation:

* Must be string
* Cannot be empty
* Must match MongoDB ObjectId format

ğŸ“Œ Prevents invalid DB queries and crashes

---

### ğŸ§© `handleValidationErrors`

Ensures request stops if ID is invalid

---

## 5ï¸âƒ£ Exporting Validators ğŸ“¦

```js
module.exports = {
    createProductValidators,
    getProductValidators
}
```

ğŸ” Allows reuse in routes:

```js
router.post("/product", createProductValidators, controller)
router.get("/product", getProductValidators, controller)
```

---

## âœ… Summary Table ğŸ“Š

| Component                 | Purpose                      |
| ------------------------- | ---------------------------- |
| `body()`                  | Validate request body fields |
| `validationResult()`      | Collect errors               |
| `handleValidationErrors`  | Central error handler        |
| `createProductValidators` | Product creation validation  |
| `getProductValidators`    | Product ID validation        |

---