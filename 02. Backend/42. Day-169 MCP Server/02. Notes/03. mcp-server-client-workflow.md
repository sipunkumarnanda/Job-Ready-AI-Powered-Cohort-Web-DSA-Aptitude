
# ‚ö° Step-by-Step Guide: MCP Server & Client with Google GenAI Integration üõ†Ô∏èü§ñ

This guide will cover:

1. Setting up the MCP server
2. Adding tools to the server
3. Creating a client to communicate with the server
4. Using AI (Google GenAI) to call server tools automatically

---

## 1Ô∏è‚É£ MCP Server: What It Is & Why You Need It

**MCP (Model Context Protocol) Server** is a **tool execution server**. It allows clients (humans or AI) to call registered tools and get structured responses.

* ‚úÖ **Use Cases**:

  * Executing specific functions like addition, API calls, or file operations.
  * Acting as a backend for AI agents to perform actions.

* ‚öôÔ∏è **How It Works**:

  * You register "tools" (functions) on the server.
  * The server listens for requests through a transport (e.g., stdin/stdout).
  * Clients send requests to call tools and receive results.

---

## 2Ô∏è‚É£ MCP Server: Full Implementation

```javascript
// mcp.server.js
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { z } from "zod";

// 1Ô∏è‚É£ Create MCP Server instance
const server = new McpServer({
  name: "demo-server",
  version: "1.0.0",
});

// 2Ô∏è‚É£ Register a tool: Addition
server.registerTool("addTwoNumbers", 
  {
    title: "Addition Tool",
    description: "Add two numbers",
    inputSchema: {
      a: z.number().describe("The first number"),
      b: z.number().describe("The second number")
    }
  }, 
  async ({ a, b }) => {
    return {
      content: [{ type: "text", text: String(a + b) }]
    };
  }
);

// 3Ô∏è‚É£ Setup transport and connect server
const transport = new StdioServerTransport();
await server.connect(transport);
```

### üîπ Explanation of Server Code

| Code Block             | Purpose                                                                                                                  |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| `McpServer`            | Creates the MCP server instance. Think of it as **turning on the server**.                                               |
| `registerTool`         | Adds a tool that clients can call. Includes **metadata** (title, description) and **input schema validation** using Zod. |
| `StdioServerTransport` | Allows communication using **stdin/stdout**, useful for child processes or pipelines.                                    |
| `server.connect`       | Starts listening for requests from clients.                                                                              |

---

## 3Ô∏è‚É£ MCP Client: What It Is & Why You Need It

**MCP Client** communicates with the server, requesting tools to be executed.

* ‚úÖ **Use Cases**:

  * Calling tools registered on the server.
  * Integrating AI models to decide which tools to call automatically.

* ‚öôÔ∏è **How It Works**:

  * You create a client instance and connect it to a transport (stdin/stdout).
  * You can list server tools and call them.
  * AI can generate tool calls which the client executes.

---

## 4Ô∏è‚É£ MCP Client Implementation

```javascript
// mcp.client.js
import { Client } from "@modelcontextprotocol/sdk/client/index.js";
import { StdioClientTransport } from "@modelcontextprotocol/sdk/client/stdio.js";
import { GoogleGenAI } from "@google/genai";
import dotenv from 'dotenv';

dotenv.config();

// 1Ô∏è‚É£ Initialize Google GenAI
const ai = new GoogleGenAI({});

// 2Ô∏è‚É£ Prepare client transport to communicate with server
const transport = new StdioClientTransport({
  command: "node",
  args: ["./mcp.server.js"]
});

// 3Ô∏è‚É£ Create MCP client instance
const client = new Client({
  name: "example-client",
  version: "1.0.0"
});

// 4Ô∏è‚É£ Connect client to server
await client.connect(transport);

// 5Ô∏è‚É£ Fetch tools from server
const tools = [];
const response = await client.listTools();
response.tools.forEach((tool) => {
  tools.push({
    name: tool.name,
    description: tool.description,
    parameters: {
      type: "OBJECT",
      properties: tool.inputSchema.properties,
      required: tool.inputSchema.required || []
    }
  });
});

// 6Ô∏è‚É£ Send AI request with tool declarations
const aiResponse = await ai.models.generateContent({
  model: 'gemini-2.0-flash',
  contents: "Add 2 and 3",
  config: {
    tools: [{
      functionDeclarations: tools
    }]
  }
});

// 7Ô∏è‚É£ Inspect AI function calls
console.log("AI Response:", aiResponse.functionCalls);

// 8Ô∏è‚É£ Call server tools based on AI response
aiResponse.functionCalls.forEach(async (call) => {
  const toolResponse = await client.callTool({
    name: call.name,
    arguments: call.args
  });
  console.log("Tool Response:", toolResponse);
});
```

---

### üîπ Explanation of Client Code

| Code Block                  | Purpose                                                               |
| --------------------------- | --------------------------------------------------------------------- |
| `Client`                    | Creates an MCP client instance.                                       |
| `StdioClientTransport`      | Connects the client to the server process using stdin/stdout.         |
| `listTools()`               | Fetches all registered tools from the server for AI to use.           |
| `GoogleGenAI`               | Sends prompts to an AI model which can decide **which tool to call**. |
| `ai.models.generateContent` | Asks AI to perform an operation using the available tools.            |
| `callTool`                  | Executes the tool on the server using AI-provided arguments.          |

---

## 5Ô∏è‚É£ Full Flow Diagram (Conceptual)

```
[User / AI] 
    ‚îÇ
    ‚ñº
[Google GenAI] ‚Üí decides which tool to call ‚Üí sends tool call
    ‚îÇ
    ‚ñº
[MCP Client] ‚Üí calls tool on server via transport
    ‚îÇ
    ‚ñº
[MCP Server] ‚Üí executes tool ‚Üí returns result
    ‚îÇ
    ‚ñº
[MCP Client] ‚Üí receives result ‚Üí prints / returns to AI
```

* **Key Points**:

  1. AI generates instructions.
  2. MCP Client acts as a bridge to execute server tools.
  3. MCP Server executes tools safely and validates input.
  4. Results flow back to the AI.

---

## 6Ô∏è‚É£ Summary: A ‚Üí Z Workflow

1. **Install dependencies**: `@modelcontextprotocol/sdk`, `@google/genai`, `zod`, `dotenv`.
2. **Create MCP server** (`mcp.server.js`):

   * Register tools with input validation.
   * Start server with a transport (stdio).
3. **Create MCP client** (`mcp.client.js`):

   * Connect to server via transport.
   * Fetch tool list for AI.
   * Call tools using AI-generated instructions.
4. **Integrate Google GenAI**:

   * AI generates function calls based on user input.
   * Client executes tools automatically.
5. **Observe results**: Tool outputs are printed or returned to AI.

---

‚úÖ **Outcome:**
You now have a fully functional **MCP server + client setup**, with AI integration, that can:

* Dynamically execute server tools
* Validate input automatically
* Integrate AI decision-making for tool usage

---