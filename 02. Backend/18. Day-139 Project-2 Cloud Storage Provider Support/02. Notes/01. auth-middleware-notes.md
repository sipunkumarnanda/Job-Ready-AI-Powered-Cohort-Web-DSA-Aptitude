
# 🛡️ Auth Middleware in Authentication

## 🔹 What is Middleware?

In Express (Node.js), a **middleware** is a function that has access to the request (`req`), response (`res`), and the next function in the request-response cycle. It's used to **modify**, **verify**, or **short-circuit** the request flow.

**Signature:**

```js
(req, res, next) => { /* logic */ }
```

## 🔹 What is Auth Middleware?

Auth middleware is a reusable function that handles **authentication logic** (i.e., validating if a user is logged in or has a valid token) before allowing access to protected routes.

Instead of writing authentication logic in every API, we extract it into a **separate file** and use it wherever needed.

---

## ✅ Why Use Auth Middleware?

| Benefit            | Description                                                    |
| ------------------ | -------------------------------------------------------------- |
| 🔁 Reusability     | Avoid writing duplicate authentication logic in multiple APIs. |
| 🔒 Security        | Ensures consistent and centralized access control.             |
| 🧼 Cleaner Code    | Keeps route handlers focused on business logic.                |
| 🔧 Maintainability | Makes it easier to update auth logic in one place.             |

---

## 📂 Recommended Folder Structure

```
project/
│
├── middleware/
│   └── auth.middleware.js ✅
│
├── routes/
│   └── protected.routes.js
│
├── controllers/
├── models/
└── server.js / app.js
```

---

## 🔐 Example: auth.middleware.js

```js
import jwt from 'jsonwebtoken'

const authMiddleware = (req, res, next) => {
  try {
    const token = req.headers.authorization?.split(' ')[1]; // Bearer <token>
    if (!token) {
      return res.status(401).json({ message: 'Unauthorized: No token provided' });
    }

    // Verify token using secret
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded; // Add user info to request
    next(); // Proceed to the next middleware or route handler
  } catch (err) {
    return res.status(401).json({ message: 'Unauthorized: Invalid token' });
  }
};

export default authMiddleware;
```

---

## 🚀 How to Use in Routes

```js
import express from 'express'
import authMiddleware from '../middleware/auth.middleware.js'
import { getUserProfile } from '../controllers/user.controller.js'

const router = express.Router()

// ✅ Protected route using middleware
router.get('/profile', authMiddleware, getUserProfile)

export default router
```

---

## 🧠 How It Works

1. **Client sends a request** to a protected route (e.g., `/profile`) with a JWT token in headers.
2. The `authMiddleware`:

   * Checks for the token.
   * Verifies it with your JWT secret.
   * If valid, attaches the decoded user data to `req.user`.
   * Calls `next()` to proceed to the controller.
3. If invalid or missing, the middleware **blocks access** and returns a `401 Unauthorized`.

---

## 🔄 Common Enhancements

* ❌ **Role-based access control (RBAC):**
  Add checks like `if (req.user.role !== 'admin') return res.status(403).send(...)`
* ⏳ **Token expiration handling**
* 🔄 **Refresh token logic** (handled in separate middleware)

---

## 🔚 Summary

* Middleware allows centralized authentication.
* Auth middleware ensures that only authorized users access protected APIs.
* It's reusable, secure, and keeps your code modular.
* Implement it once, use it everywhere.

---