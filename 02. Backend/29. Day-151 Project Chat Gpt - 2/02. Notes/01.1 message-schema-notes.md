
# 📚 Message Schema in Mongoose

# message.model.js
```js
import mongoose from "mongoose";

const messageSchema = new mongoose.Schema(
  {
    userId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "user",
    },

    chatId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "chat",
    },

    content: {
      type: String,
      required: true,
    },

    role: {
      type: String,
      enum: ["user", "model", "system"],
      default: "user",
    },
  },
  {
    timestamps: true,
  }
);

const messageModel = mongoose.model("message", messageSchema);

export default messageModel;
```

---

## 🛠️ 1. Importing Mongoose

### 📌 Code:

```js
import mongoose from "mongoose";
```

### 📖 Explanation:

* **Mongoose** is an **ODM (Object Data Modeling) library** for MongoDB and Node.js.
* It allows us to define schemas and models to structure MongoDB documents in a more organized way.
* Instead of directly writing raw MongoDB queries, Mongoose provides **schema-based abstraction** for clean and scalable development.

---

## 🏗️ 2. Creating a Schema

### 📌 Code:

```js
const messageSchema = new mongoose.Schema(
  {
    userId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "user",
    },

    chatId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "chat",
    },

    content: {
      type: String,
      required: true,
    },

    role: {
      type: String,
      enum: ["user", "model", "system"],
      default: "user",
    },
  },
  {
    timestamps: true,
  }
);
```

### 📖 Explanation:

A **schema** in Mongoose defines the structure of a MongoDB document. Let’s break down each field:

---

### 👤 **userId**

```js
userId: {
  type: mongoose.Schema.Types.ObjectId,
  ref: "user",
}
```

* **Type** → `ObjectId` (special type used to uniquely identify documents in MongoDB).
* **ref: "user"** → Connects this field to the `"user"` collection.
* Purpose → Establishes a **relationship** between a message and the **user who sent it**.
* 🔗 Example: Helps us easily fetch which user sent the message via `.populate("userId")`.

---

### 💬 **chatId**

```js
chatId: {
  type: mongoose.Schema.Types.ObjectId,
  ref: "chat",
}
```

* **Type** → `ObjectId`.
* **ref: "chat"** → Connects the message to a **chat session** (conversation thread).
* Purpose → Ensures every message belongs to a **specific chat**.

---

### 📝 **content**

```js
content: {
  type: String,
  required: true,
}
```

* **Type** → `String`.
* **required: true** → A message cannot exist without content.
* Purpose → Stores the actual **text message** (user’s message, system prompt, or AI’s response).

---

### 🎭 **role**

```js
role: {
  type: String,
  enum: ["user", "model", "system"],
  default: "user",
}
```

* **Type** → `String`.
* **enum** → Restricts values to `"user"`, `"model"`, or `"system"`.
* **default: "user"** → If no role is specified, it assumes the sender is a user.
* Purpose → Identifies **who created the message**:

  * `"user"` → Human user 👤
  * `"model"` → AI/assistant 🤖
  * `"system"` → System-generated instruction ⚙️

---

### ⏳ **timestamps**

```js
{
  timestamps: true,
}
```

* Mongoose automatically adds:

  * `createdAt` → When the message was created 🕒
  * `updatedAt` → Last updated time 🔄
* Purpose → Helps track **message history & auditing**.

---

## 🏷️ 3. Creating the Model

### 📌 Code:

```js
const messageModel = mongoose.model("message", messageSchema);
```

### 📖 Explanation:

* A **model** is a **compiled version of the schema** that lets us interact with the MongoDB collection.
* `"message"` → The collection name (Mongoose automatically pluralizes it → `messages`).
* `messageSchema` → Structure applied to documents inside this collection.
* Using `messageModel`, we can perform CRUD operations:

  * `messageModel.create({...})` → Add a new message ✍️
  * `messageModel.find({...})` → Retrieve messages 🔎
  * `messageModel.updateOne({...})` → Modify a message 🔧
  * `messageModel.deleteOne({...})` → Delete a message ❌

---

## 📤 4. Exporting the Model

### 📌 Code:

```js
export default messageModel;
```

### 📖 Explanation:

* Allows us to use `messageModel` in other files of the project.
* Ensures clean **modular structure** in Node.js apps.

---

## 🚀 **Summary**

* We created a **Message Schema** to represent chat messages in a database.
* It links messages with **users** and **chats**, keeps track of **content**, and identifies **roles**.
* Added automatic **timestamps** for message tracking.
* Finally, compiled the schema into a **Mongoose model** for easy database operations.

---

✨ This schema is super useful for building **chat apps, AI conversation logs, and messaging systems**!

---