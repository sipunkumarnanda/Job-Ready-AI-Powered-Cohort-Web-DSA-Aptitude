
# ğŸ“š Message Schema in Mongoose

# message.model.js
```js
import mongoose from "mongoose";

const messageSchema = new mongoose.Schema(
  {
    userId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "user",
    },

    chatId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "chat",
    },

    content: {
      type: String,
      required: true,
    },

    role: {
      type: String,
      enum: ["user", "model", "system"],
      default: "user",
    },
  },
  {
    timestamps: true,
  }
);

const messageModel = mongoose.model("message", messageSchema);

export default messageModel;
```

---

## ğŸ› ï¸ 1. Importing Mongoose

### ğŸ“Œ Code:

```js
import mongoose from "mongoose";
```

### ğŸ“– Explanation:

* **Mongoose** is an **ODM (Object Data Modeling) library** for MongoDB and Node.js.
* It allows us to define schemas and models to structure MongoDB documents in a more organized way.
* Instead of directly writing raw MongoDB queries, Mongoose provides **schema-based abstraction** for clean and scalable development.

---

## ğŸ—ï¸ 2. Creating a Schema

### ğŸ“Œ Code:

```js
const messageSchema = new mongoose.Schema(
  {
    userId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "user",
    },

    chatId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "chat",
    },

    content: {
      type: String,
      required: true,
    },

    role: {
      type: String,
      enum: ["user", "model", "system"],
      default: "user",
    },
  },
  {
    timestamps: true,
  }
);
```

### ğŸ“– Explanation:

A **schema** in Mongoose defines the structure of a MongoDB document. Letâ€™s break down each field:

---

### ğŸ‘¤ **userId**

```js
userId: {
  type: mongoose.Schema.Types.ObjectId,
  ref: "user",
}
```

* **Type** â†’ `ObjectId` (special type used to uniquely identify documents in MongoDB).
* **ref: "user"** â†’ Connects this field to the `"user"` collection.
* Purpose â†’ Establishes a **relationship** between a message and the **user who sent it**.
* ğŸ”— Example: Helps us easily fetch which user sent the message via `.populate("userId")`.

---

### ğŸ’¬ **chatId**

```js
chatId: {
  type: mongoose.Schema.Types.ObjectId,
  ref: "chat",
}
```

* **Type** â†’ `ObjectId`.
* **ref: "chat"** â†’ Connects the message to a **chat session** (conversation thread).
* Purpose â†’ Ensures every message belongs to a **specific chat**.

---

### ğŸ“ **content**

```js
content: {
  type: String,
  required: true,
}
```

* **Type** â†’ `String`.
* **required: true** â†’ A message cannot exist without content.
* Purpose â†’ Stores the actual **text message** (userâ€™s message, system prompt, or AIâ€™s response).

---

### ğŸ­ **role**

```js
role: {
  type: String,
  enum: ["user", "model", "system"],
  default: "user",
}
```

* **Type** â†’ `String`.
* **enum** â†’ Restricts values to `"user"`, `"model"`, or `"system"`.
* **default: "user"** â†’ If no role is specified, it assumes the sender is a user.
* Purpose â†’ Identifies **who created the message**:

  * `"user"` â†’ Human user ğŸ‘¤
  * `"model"` â†’ AI/assistant ğŸ¤–
  * `"system"` â†’ System-generated instruction âš™ï¸

---

### â³ **timestamps**

```js
{
  timestamps: true,
}
```

* Mongoose automatically adds:

  * `createdAt` â†’ When the message was created ğŸ•’
  * `updatedAt` â†’ Last updated time ğŸ”„
* Purpose â†’ Helps track **message history & auditing**.

---

## ğŸ·ï¸ 3. Creating the Model

### ğŸ“Œ Code:

```js
const messageModel = mongoose.model("message", messageSchema);
```

### ğŸ“– Explanation:

* A **model** is a **compiled version of the schema** that lets us interact with the MongoDB collection.
* `"message"` â†’ The collection name (Mongoose automatically pluralizes it â†’ `messages`).
* `messageSchema` â†’ Structure applied to documents inside this collection.
* Using `messageModel`, we can perform CRUD operations:

  * `messageModel.create({...})` â†’ Add a new message âœï¸
  * `messageModel.find({...})` â†’ Retrieve messages ğŸ”
  * `messageModel.updateOne({...})` â†’ Modify a message ğŸ”§
  * `messageModel.deleteOne({...})` â†’ Delete a message âŒ

---

## ğŸ“¤ 4. Exporting the Model

### ğŸ“Œ Code:

```js
export default messageModel;
```

### ğŸ“– Explanation:

* Allows us to use `messageModel` in other files of the project.
* Ensures clean **modular structure** in Node.js apps.

---

## ğŸš€ **Summary**

* We created a **Message Schema** to represent chat messages in a database.
* It links messages with **users** and **chats**, keeps track of **content**, and identifies **roles**.
* Added automatic **timestamps** for message tracking.
* Finally, compiled the schema into a **Mongoose model** for easy database operations.

---

âœ¨ This schema is super useful for building **chat apps, AI conversation logs, and messaging systems**!

---