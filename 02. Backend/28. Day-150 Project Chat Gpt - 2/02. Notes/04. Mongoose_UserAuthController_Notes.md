
# üë§ **User Authentication Controller (Register & Login)**

---

## üìú Code

```js
import userModel from "../models/user.model.js"
import bcrypt from 'bcryptjs'
import jwt from 'jsonwebtoken'


async function registerUser(req,res) {
    const {fullName : {firstName, lastName}, email, password} = req.body

    const isUserAlreadyExists = await userModel.findOne({
        email
    })

    if(isUserAlreadyExists){
        return res.status(400).json({
            message : "User already exists"
        })
    }

    const hashPassword = await bcrypt.hash(password, 10)

    const user = await userModel.create({
        fullName : {
            firstName, lastName
        }, 
        email, 
        password : hashPassword
    })

    const token = jwt.sign({id : user._id}, process.env.JWT_SECRETE)

    res.cookie("token", token)

    res.status(201).json({
        message : "User registered successfully",
        user : {
            email : user.email,
            _id : user._id,
            fullName : user.fullName
        }
    })
}

async function loginUser(req, res) {
    const {email, password} = req.body

    const user = await userModel.findOne({
        email
    })

    if(!user){
        return res.status(400).json({
            message : "invalid email or password"
        })
    }

    const isValidPassword = await bcrypt.compare(password, user.password)

    if(!isValidPassword){
        return res.status(400).json({
            message : "invalid email or password"
        })
    }

        const token = jwt.sign({id : user._id}, process.env.JWT_SECRETE)

        res.cookie("token", token)

        res.status(200).json({
            message : "user loggedin successfully",
            user : {
                email : user.email,
                _id : user._id,
                fullName : user.fullName
            }
        })
}



export {
    registerUser,
    loginUser
}
```

---

## üîç Explanation

### 1Ô∏è‚É£ Imports

```js
import userModel from "../models/user.model.js"
import bcrypt from 'bcryptjs'
import jwt from 'jsonwebtoken'
```

* **`userModel`** ‚Üí Mongoose User model for interacting with MongoDB.
* **`bcryptjs`** ‚Üí used for **hashing & comparing passwords** securely.
* **`jsonwebtoken (jwt)`** ‚Üí used for generating JWT tokens for authentication.

---

### 2Ô∏è‚É£ Register User Function

```js
async function registerUser(req,res) { ... }
```

‚ú® **Step-by-step:**

1. **Extract data from request body**

   ```js
   const {fullName : {firstName, lastName}, email, password} = req.body
   ```

   * Destructures `firstName`, `lastName`, `email`, and `password` directly from incoming JSON.

2. **Check if user already exists**

   ```js
   const isUserAlreadyExists = await userModel.findOne({ email })
   ```

   * Queries MongoDB to see if another user with the same email exists.
   * If found ‚Üí return **400 Bad Request** with message `"User already exists"`.

3. **Hash the password**

   ```js
   const hashPassword = await bcrypt.hash(password, 10)
   ```

   * Uses bcrypt to hash the password with **10 salt rounds**.
   * Prevents storing plain-text passwords in DB.

4. **Create new user**

   ```js
   const user = await userModel.create({
       fullName : { firstName, lastName }, 
       email, 
       password : hashPassword
   })
   ```

   * Saves new user into MongoDB with hashed password.

5. **Generate JWT token**

   ```js
   const token = jwt.sign({id : user._id}, process.env.JWT_SECRETE)
   ```

   * Payload: `{ id: user._id }`
   * Secret: stored in `.env` (`JWT_SECRETE`).

6. **Store token in cookie**

   ```js
   res.cookie("token", token)
   ```

   * Sets a cookie named `"token"` in the browser.

7. **Send response**

   ```js
   res.status(201).json({
       message : "User registered successfully",
       user : {
           email : user.email,
           _id : user._id,
           fullName : user.fullName
       }
   })
   ```

   * Returns **201 Created** with user data (excluding password).

---

### 3Ô∏è‚É£ Login User Function

```js
async function loginUser(req, res) { ... }
```

‚ú® **Step-by-step:**

1. **Extract login credentials**

   ```js
   const {email, password} = req.body
   ```

2. **Find user by email**

   ```js
   const user = await userModel.findOne({ email })
   ```

   * If not found ‚Üí respond with **400 Bad Request** and `"invalid email or password"`.

3. **Check password validity**

   ```js
   const isValidPassword = await bcrypt.compare(password, user.password)
   ```

   * Compares given password with hashed password in DB.
   * If mismatch ‚Üí return `"invalid email or password"`.

4. **Generate JWT token**

   ```js
   const token = jwt.sign({id : user._id}, process.env.JWT_SECRETE)
   ```

5. **Store token in cookie**

   ```js
   res.cookie("token", token)
   ```

6. **Send success response**

   ```js
   res.status(200).json({
       message : "user loggedin successfully",
       user : {
           email : user.email,
           _id : user._id,
           fullName : user.fullName
       }
   })
   ```

---

### 4Ô∏è‚É£ Exporting Functions

```js
export {
    registerUser,
    loginUser
}
```

* Exports both functions to be used in **route files**.
* Example:

  ```js
  import { registerUser, loginUser } from "../controllers/auth.controller.js";

  router.post("/register", registerUser);
  router.post("/login", loginUser);
  ```

---

## ‚úÖ Key Takeaways

* üîí **Password Security** ‚Üí Always hashed before saving.
* üéü **JWT Authentication** ‚Üí Token created and sent as cookie.
* üõë **Validation** ‚Üí Checks for existing users during registration.
* ‚ö†Ô∏è **Error Handling** ‚Üí Sends proper status codes (`400`, `201`, `200`).
* üöÄ **Cookie-based Auth** ‚Üí Simplifies session handling.

---