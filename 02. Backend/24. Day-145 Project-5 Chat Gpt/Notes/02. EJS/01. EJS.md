
# ğŸ“˜ EJS (Embedded JavaScript Templates) â€” Deep & Easy Guide

---

## ğŸ”¹ What is EJS?

**EJS** stands for **Embedded JavaScript**. Itâ€™s a **templating language** that lets you **write HTML pages and sprinkle JavaScript inside** to dynamically inject data (like a userâ€™s name, a product list, etc.).

* You usually use it on the **server side** with **Node.js + Express** to render HTML before sending it to the browser.
* File extension: **`.ejs`**
* Think of it as **plain HTML + little code islands** to loop, conditionally show things, and print values.

> ğŸ§  Analogy: EJS is like HTML with â€œwindowsâ€ where live data flows in.

---

## ğŸ”¹ Where EJS Fits (and why people use it)

* **Server-Side Rendering (SSR)**: Generate HTML on the server â†’ better SEO, fast first paint, simple mental model.
* **Classic MVC apps** with Express: routes â†’ controller â†’ **`res.render('view.ejs', data)`**.
* **Low complexity** sites: dashboards, admin panels, small apps, landing pages.
* **No build step required**: just install and useâ€”great for rapid prototyping.

> If you need **rich client-side interactivity** or SPA patterns, use React/Vue. If you want **simple, fast SSR**, EJS is perfect.

---

## ğŸ”¹ Core Idea in One Sentence

Write HTML, and wherever you need dynamic bits, use **EJS tags** like
`<%= value %>`, `<% if (...) { %> ... <% } %>`, `<% items.forEach(...) { %> ... <% } %>`.

---

## ğŸ”¹ EJS Tag Cheat-Sheet (ğŸ’¡ memorize these)

| Tag           | Purpose                        | Escaping?        | Example                   |
| ------------- | ------------------------------ | ---------------- | ------------------------- |
| `<% ... %>`   | Run JS code (no output)        | â€”                | `<% if (user) { %>`       |
| `<%= ... %>`  | Output **escaped** value       | âœ… (prevents XSS) | `<%= user.name %>`        |
| `<%- ... %>`  | Output **raw, unescaped** HTML | âŒ (dangerous)    | `<%- post.contentHtml %>` |
| `<%# ... %>`  | Comment (not rendered)         | â€”                | `<%# developer note %>`   |
| `<%%` / `%%>` | Print literal `<%` or `%>`     | â€”                | `Look: <%%= not code %%>` |

> ğŸ›¡ï¸ **Rule of thumb:** Use `<%= ... %>` by default. Use `<%- ... %>` **only** when youâ€™re 100% sure the content is safe HTML.

---

## ğŸ”¹ Express + EJS: Typical Setup

**Install & configure**

```bash
npm i ejs
```

```js
import express from "express";
import path from "path";

const app = express();
app.set("view engine", "ejs");
app.set("views", path.join(process.cwd(), "views")); // /views folder
```

**Route â†’ render a view**

```js
app.get("/", (req, res) => {
  res.render("home", {
    title: "Welcome",
    user: { name: "Sipun" },
    items: [{ text: "First" }, { text: "Second" }]
  });
});
```

**`views/home.ejs`**

```ejs
<!doctype html>
<html>
  <head><title><%= title %></title></head>
  <body>
    <h1>Hello, <%= user.name %> ğŸ‘‹</h1>

    <% if (items.length) { %>
      <ul>
        <% items.forEach((it) => { %>
          <li><%= it.text %></li>
        <% }) %>
      </ul>
    <% } else { %>
      <p>No items yet.</p>
    <% } %>
  </body>
</html>
```

---

## ğŸ”¹ Partials & Layouts (Donâ€™t Repeat Yourself)

* **Partials** are reusable snippets (headers, footers, nav bars).
* Create `views/partials/header.ejs`, then include:

```ejs
<%- include('partials/header', { title }) %>
```

> **Layouts**: EJS doesnâ€™t have native layouts, but you can simulate with a `layout.ejs` and includes, or use packages like **ejs-mate**.

**With `ejs-mate` (optional)**

```bash
npm i ejs-mate
```

```js
import engine from "ejs-mate";
app.engine("ejs", engine);
```

Then in a view:

```ejs
<% layout('layouts/main') %>
<h1>Page content</h1>
```

---

## ğŸ”¹ Common Patterns Youâ€™ll Use Daily

### 1) Conditionals

```ejs
<% if (user && user.isAdmin) { %>
  <a href="/admin">Admin</a>
<% } %>
```

### 2) Loops

```ejs
<ul>
  <% for (const p of products) { %>
    <li><%= p.name %> â€” $<%= p.price %></li>
  <% } %>
</ul>
```

### 3) Formatting / Helpers

Define helpers in **`res.locals`** or **`app.locals`**:

```js
app.locals.currency = (n) => n.toFixed(2);
```

Use in view:

```ejs
$<%= currency(product.price) %>
```

---

## ğŸ”¹ Security Essentials (please donâ€™t skip)

* **XSS protection:** `<%= ... %>` escapes HTML (`<, >, &, ", '`) â†’ safe by default.
* **Unescaped output:** `<%- ... %>` **does not** escapeâ€”**never** render untrusted user input with it.
* **CSRF tokens:** when building forms, render a server-generated CSRF token.
* **Validation & sanitization:** validate all data on the server before rendering.

> âœ… If you always default to `<%= ... %>` for user content, you avoid most XSS mistakes.

---

## ğŸ”¹ Performance Tips

* **View caching:** In production, Express caches compiled templates (`app.set('view cache', true)`).
* **Minimize logic in views:** Keep heavy logic in controllers; views should mostly **display**.
* **Pagination & data slicing:** Donâ€™t send huge arrays to the template.
* **Static assets:** Serve CSS/JS via `express.static` and compress with gzip/brotli.

---

## ğŸ”¹ EJS vs Alternatives (When to choose what)

| Use case             | EJS                      | Handlebars              | Pug                    | React/Next.js    |
| -------------------- | ------------------------ | ----------------------- | ---------------------- | ---------------- |
| Learning curve       | âœ… easiest (HTML + JS)    | Easy                    | Medium (indent syntax) | Higher           |
| Logic in templates   | Full JS                  | Limited (helpers)       | Full JS                | Components/JSX   |
| SEO + SSR            | Great                    | Great                   | Great                  | Great            |
| Client interactivity | Limited (add vanilla JS) | Limited                 | Limited                | âœ… strongest      |
| Best for             | Classic SSR, dashboards  | Strict/simple templates | Minimalist syntax fans | SPAs, complex UI |

> If you want **simple SSR now**, choose **EJS**. If youâ€™re building a **single-page app** with heavy client interactivity, go **React/Next**.

---

## ğŸ”¹ Debugging & Quality

* **Show helpful errors:** in dev, set `app.set('env', 'development')`.
* **Template errors** show filename/lineâ€”keep files small & modular.
* **Linting:** ESLint wonâ€™t parse EJS, but lint your server JS and keep templates tidy.

---

## ğŸ”¹ Advanced (optional but nice)

* **Custom delimiter:** `ejs.delimiter = '?'` lets you use `<? ... ?>` if you prefer.
* **Client-side EJS:** You can ship EJS to the browser and render thereâ€”but in modern stacks, CSR is usually handled by frameworks like React.
* **Internationalization (i18n):** Pass translation helpers into views through `app.locals` or `res.locals`.

---

## ğŸ”¹ Quick Checklist (when you build a page)

* [ ] Installed & configured EJS as view engine
* [ ] Views organized (`views/pages`, `views/partials`, `views/layouts`)
* [ ] Use `<%= %>` for user values (escaped)
* [ ] Use partials for header/footer/nav
* [ ] Keep logic light in templates
* [ ] Enable caching in production

---

## âœ… One-liner Summary

**EJS is a lightweight, HTML-first templating engine for Node.js that lets you render dynamic pages on the server using familiar JavaScriptâ€”fast to learn, secure by default, and perfect for classic SSR.** âœ¨

---