
# 📘 EJS (Embedded JavaScript Templates) — Deep & Easy Guide

---

## 🔹 What is EJS?

**EJS** stands for **Embedded JavaScript**. It’s a **templating language** that lets you **write HTML pages and sprinkle JavaScript inside** to dynamically inject data (like a user’s name, a product list, etc.).

* You usually use it on the **server side** with **Node.js + Express** to render HTML before sending it to the browser.
* File extension: **`.ejs`**
* Think of it as **plain HTML + little code islands** to loop, conditionally show things, and print values.

> 🧠 Analogy: EJS is like HTML with “windows” where live data flows in.

---

## 🔹 Where EJS Fits (and why people use it)

* **Server-Side Rendering (SSR)**: Generate HTML on the server → better SEO, fast first paint, simple mental model.
* **Classic MVC apps** with Express: routes → controller → **`res.render('view.ejs', data)`**.
* **Low complexity** sites: dashboards, admin panels, small apps, landing pages.
* **No build step required**: just install and use—great for rapid prototyping.

> If you need **rich client-side interactivity** or SPA patterns, use React/Vue. If you want **simple, fast SSR**, EJS is perfect.

---

## 🔹 Core Idea in One Sentence

Write HTML, and wherever you need dynamic bits, use **EJS tags** like
`<%= value %>`, `<% if (...) { %> ... <% } %>`, `<% items.forEach(...) { %> ... <% } %>`.

---

## 🔹 EJS Tag Cheat-Sheet (💡 memorize these)

| Tag           | Purpose                        | Escaping?        | Example                   |
| ------------- | ------------------------------ | ---------------- | ------------------------- |
| `<% ... %>`   | Run JS code (no output)        | —                | `<% if (user) { %>`       |
| `<%= ... %>`  | Output **escaped** value       | ✅ (prevents XSS) | `<%= user.name %>`        |
| `<%- ... %>`  | Output **raw, unescaped** HTML | ❌ (dangerous)    | `<%- post.contentHtml %>` |
| `<%# ... %>`  | Comment (not rendered)         | —                | `<%# developer note %>`   |
| `<%%` / `%%>` | Print literal `<%` or `%>`     | —                | `Look: <%%= not code %%>` |

> 🛡️ **Rule of thumb:** Use `<%= ... %>` by default. Use `<%- ... %>` **only** when you’re 100% sure the content is safe HTML.

---

## 🔹 Express + EJS: Typical Setup

**Install & configure**

```bash
npm i ejs
```

```js
import express from "express";
import path from "path";

const app = express();
app.set("view engine", "ejs");
app.set("views", path.join(process.cwd(), "views")); // /views folder
```

**Route → render a view**

```js
app.get("/", (req, res) => {
  res.render("home", {
    title: "Welcome",
    user: { name: "Sipun" },
    items: [{ text: "First" }, { text: "Second" }]
  });
});
```

**`views/home.ejs`**

```ejs
<!doctype html>
<html>
  <head><title><%= title %></title></head>
  <body>
    <h1>Hello, <%= user.name %> 👋</h1>

    <% if (items.length) { %>
      <ul>
        <% items.forEach((it) => { %>
          <li><%= it.text %></li>
        <% }) %>
      </ul>
    <% } else { %>
      <p>No items yet.</p>
    <% } %>
  </body>
</html>
```

---

## 🔹 Partials & Layouts (Don’t Repeat Yourself)

* **Partials** are reusable snippets (headers, footers, nav bars).
* Create `views/partials/header.ejs`, then include:

```ejs
<%- include('partials/header', { title }) %>
```

> **Layouts**: EJS doesn’t have native layouts, but you can simulate with a `layout.ejs` and includes, or use packages like **ejs-mate**.

**With `ejs-mate` (optional)**

```bash
npm i ejs-mate
```

```js
import engine from "ejs-mate";
app.engine("ejs", engine);
```

Then in a view:

```ejs
<% layout('layouts/main') %>
<h1>Page content</h1>
```

---

## 🔹 Common Patterns You’ll Use Daily

### 1) Conditionals

```ejs
<% if (user && user.isAdmin) { %>
  <a href="/admin">Admin</a>
<% } %>
```

### 2) Loops

```ejs
<ul>
  <% for (const p of products) { %>
    <li><%= p.name %> — $<%= p.price %></li>
  <% } %>
</ul>
```

### 3) Formatting / Helpers

Define helpers in **`res.locals`** or **`app.locals`**:

```js
app.locals.currency = (n) => n.toFixed(2);
```

Use in view:

```ejs
$<%= currency(product.price) %>
```

---

## 🔹 Security Essentials (please don’t skip)

* **XSS protection:** `<%= ... %>` escapes HTML (`<, >, &, ", '`) → safe by default.
* **Unescaped output:** `<%- ... %>` **does not** escape—**never** render untrusted user input with it.
* **CSRF tokens:** when building forms, render a server-generated CSRF token.
* **Validation & sanitization:** validate all data on the server before rendering.

> ✅ If you always default to `<%= ... %>` for user content, you avoid most XSS mistakes.

---

## 🔹 Performance Tips

* **View caching:** In production, Express caches compiled templates (`app.set('view cache', true)`).
* **Minimize logic in views:** Keep heavy logic in controllers; views should mostly **display**.
* **Pagination & data slicing:** Don’t send huge arrays to the template.
* **Static assets:** Serve CSS/JS via `express.static` and compress with gzip/brotli.

---

## 🔹 EJS vs Alternatives (When to choose what)

| Use case             | EJS                      | Handlebars              | Pug                    | React/Next.js    |
| -------------------- | ------------------------ | ----------------------- | ---------------------- | ---------------- |
| Learning curve       | ✅ easiest (HTML + JS)    | Easy                    | Medium (indent syntax) | Higher           |
| Logic in templates   | Full JS                  | Limited (helpers)       | Full JS                | Components/JSX   |
| SEO + SSR            | Great                    | Great                   | Great                  | Great            |
| Client interactivity | Limited (add vanilla JS) | Limited                 | Limited                | ✅ strongest      |
| Best for             | Classic SSR, dashboards  | Strict/simple templates | Minimalist syntax fans | SPAs, complex UI |

> If you want **simple SSR now**, choose **EJS**. If you’re building a **single-page app** with heavy client interactivity, go **React/Next**.

---

## 🔹 Debugging & Quality

* **Show helpful errors:** in dev, set `app.set('env', 'development')`.
* **Template errors** show filename/line—keep files small & modular.
* **Linting:** ESLint won’t parse EJS, but lint your server JS and keep templates tidy.

---

## 🔹 Advanced (optional but nice)

* **Custom delimiter:** `ejs.delimiter = '?'` lets you use `<? ... ?>` if you prefer.
* **Client-side EJS:** You can ship EJS to the browser and render there—but in modern stacks, CSR is usually handled by frameworks like React.
* **Internationalization (i18n):** Pass translation helpers into views through `app.locals` or `res.locals`.

---

## 🔹 Quick Checklist (when you build a page)

* [ ] Installed & configured EJS as view engine
* [ ] Views organized (`views/pages`, `views/partials`, `views/layouts`)
* [ ] Use `<%= %>` for user values (escaped)
* [ ] Use partials for header/footer/nav
* [ ] Keep logic light in templates
* [ ] Enable caching in production

---

## ✅ One-liner Summary

**EJS is a lightweight, HTML-first templating engine for Node.js that lets you render dynamic pages on the server using familiar JavaScript—fast to learn, secure by default, and perfect for classic SSR.** ✨

---