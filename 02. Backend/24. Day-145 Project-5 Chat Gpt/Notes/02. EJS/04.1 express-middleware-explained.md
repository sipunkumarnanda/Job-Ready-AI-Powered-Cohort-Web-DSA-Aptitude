
# üìù **Understanding Express Middleware and Settings**

---

## 1Ô∏è‚É£ `app.set("view engine", "ejs")`

* **What it does:**
  This line tells **Express** that the default **templating engine** we want to use is **EJS (Embedded JavaScript)**.

* **Why we need this:**
  Normally, when you call `res.render("index")`, Express must know:

  1. Where to find the **view files** (like `.ejs` files).
  2. What engine to use to render them.

  By default, Express doesn‚Äôt know how to handle `.ejs` files. This line registers EJS as the "view engine," so Express can compile `.ejs` into **HTML** and send it to the browser.

* **In your code‚Äôs context:**

  ```js
  router.get('/', (req, res) => {
      res.render("index"); // This works only because of app.set("view engine", "ejs")
  })
  ```

  Without `app.set("view engine", "ejs")`, this would fail because Express wouldn‚Äôt know how to process `index.ejs`.

---

## 2Ô∏è‚É£ `app.use(express.json())`

* **What it does:**
  This middleware parses **incoming requests with JSON payloads**.
  Meaning: If the client (like Postman, or frontend with `fetch`) sends data in JSON format in the request body, Express will automatically parse it into a JavaScript object that you can access in `req.body`.

* **Example:**

  ```json
  POST /api/user
  Content-Type: application/json

  {
    "name": "Sipun",
    "age": 22
  }
  ```

  Then inside your route:

  ```js
  app.post('/api/user', (req, res) => {
      console.log(req.body.name); // "Sipun"
  });
  ```

* **Why we need this:**
  Without `express.json()`, `req.body` would be `undefined`.
  This middleware makes it super easy to handle APIs that work with JSON.

---

## 3Ô∏è‚É£ `app.use(express.urlencoded({ extended: true }))`

* **What it does:**
  This middleware is used for parsing **form data** (data sent via HTML forms).

  * If a user submits a form like:

    ```html
    <form action="/submit" method="post">
        <input type="text" name="username" value="Sipun">
        <input type="text" name="age" value="22">
        <button type="submit">Submit</button>
    </form>
    ```

    Express will parse that request body, and you can access it like:

    ```js
    app.post('/submit', (req, res) => {
        console.log(req.body.username); // "Sipun"
        console.log(req.body.age);      // "22"
    });
    ```

* **What does `extended: true` mean?**

  * `extended: false`: Parses simple key-value pairs only (no nested objects).
  * `extended: true`: Allows for **rich objects and arrays** to be encoded in the URL (using the `qs` library).

  Example with nested object:

  ```
  user[name]=Sipun&user[age]=22
  ```

  ‚Üí With `extended: true`, Express parses it into:

  ```js
  req.body = { user: { name: "Sipun", age: "22" } }
  ```

* **Why we need this:**
  It makes Express able to handle **form submissions** (like login forms, signup forms) seamlessly.

---

## 4Ô∏è‚É£ `app.use(express.static('public'))`

* **What it does:**
  This line tells Express to serve **static files** (like CSS, JS, images) from the `public` folder.

  That‚Äôs why in your `index.ejs` you can write:

  ```html
  <link rel="stylesheet" href="style.css">
  <script src="script.js"></script>
  ```

  and Express will know to look inside the `public` folder for `style.css` and `script.js`.

* **Why we need this:**
  Without it, Express would not serve static files automatically, and you‚Äôd have to manually create routes for each CSS/JS/image file ‚Äî which is painful.

* **In your project structure:**

  ```
  backend/
    public/
      style.css   ‚úÖ served at http://localhost:3000/style.css
      script.js   ‚úÖ served at http://localhost:3000/script.js
  ```

---

# üöÄ **Summary**

1. `app.set("view engine", "ejs")` ‚Üí Enables EJS templates (`.ejs`) for rendering views.
2. `app.use(express.json())` ‚Üí Parses JSON requests (mainly for APIs).
3. `app.use(express.urlencoded({ extended: true }))` ‚Üí Parses form submissions (HTML forms).
4. `app.use(express.static('public'))` ‚Üí Serves static files like CSS/JS/images.

---