
# **heart of authentication** â€” the `auth.controller.js` file â¤ï¸.
This file contains the **logic** behind your routes (`/register` and `/login`).

Letâ€™s break it step by step in **easy, emoji-filled, beginner-to-hero style notes** ğŸš€.

---

# ğŸŒŸ `auth.controller.js` Explained in Depth

---

## ğŸŸ¢ 1. Import Statements

```js
import userModel from "../models/user.model.js";
import bcrypt from "bcryptjs";
import jwt from "jsonwebtoken";
import dotenv from "dotenv";
dotenv.config();
```

* **userModel** â†’ Mongoose model for users ğŸ§‘â€ğŸ’» (from `user.model.js`).
* **bcryptjs** â†’ Library to **hash & compare passwords** ğŸ”.
* **jsonwebtoken (JWT)** â†’ For **creating tokens** to identify users securely ğŸŸï¸.
* **dotenv** â†’ Loads environment variables (`.env` file) like `JWT_SECRETE` ğŸ”‘.

ğŸ‘‰ This setup makes sure we can **securely register & log in users**.

---

## ğŸŸ¢ 2. `getRegisterController`

```js
async function getRegisterController(req, res) {
  res.render("register");
}
```

* **Purpose**: Show the registration form ğŸ“.
* When user visits `/auth/register` â†’ this controller renders `register.ejs`.

ğŸ‘‰ Think of it as **â€œDisplay the signup pageâ€** ğŸ“„.

---

## ğŸŸ¢ 3. `postRegisterController`

```js
async function postRegisterController(req, res) {
  const { username, email, password } = req.body;
  
  // 1. Check if user already exists
  const isUserExists = await userModel.findOne({
    $or: [{ username: username }, { email: email }],
  });

  if (isUserExists) {
    return res.status(400).json({
      message: "User already exists with this username and email",
    });
  }

  // 2. Hash password
  const hashedPassword = await bcrypt.hash(password, 10);

  // 3. Save new user to DB
  const user = await userModel.create({
    username,
    email,
    password: hashedPassword,
  });

  // 4. Generate JWT token
  const token = jwt.sign({ id: user._id }, process.env.JWT_SECRETE);

  // 5. Save token in cookie
  res.cookie("token", token);

  // 6. Send success response
  res.status(201).json({
    message: "user registered successfully",
    user,
  });
}
```

### Step by Step:

1. **Extract data** from `req.body` (form submission).
2. **Check if user already exists** (username/email must be unique ğŸš«).
3. **Hash password** with bcrypt (never save raw passwords âŒ).
4. **Create user** in MongoDB ğŸ—„ï¸.
5. **Generate JWT token** with user ID (for authentication).
6. **Store token in cookie** ğŸª.
7. Respond with success âœ….

ğŸ‘‰ This is the **full registration process** from scratch!

---

## ğŸŸ¢ 4. `getLoginController`

```js
async function getLoginController(req, res) {
  res.render("login");
}
```

* **Purpose**: Show the login form ğŸ”‘.
* When user visits `/auth/login` â†’ this controller renders `login.ejs`.

ğŸ‘‰ Think of it as **â€œDisplay the login pageâ€**.

---

## ğŸŸ¢ 5. `postLoginController`

```js
async function postLoginController(req, res) {
    const {identifier, password} = req.body

    // 1. Find user (by email or username)
    const user = await userModel.findOne({
        $or : [
            {email : identifier},
            {username : identifier}
        ]
    })

    if(!user){
       return res.redirect('/login?error=User not found')
    }

    // 2. Compare entered password with hashed one
    const isPasswordValid = await bcrypt.compare(password, user.password)

    if(!isPasswordValid){
         res.status(400).json({
            message : "Invalid password"
         })
    }

    // 3. Generate JWT token
    const token = jwt.sign({ id: user._id }, process.env.JWT_SECRETE);

    // 4. Save token in cookie
    res.cookie("token", token)

    // 5. Send success response
    res.status(201).json({
        message : "user loggedin successfully",
        user
    })
}
```

### Step by Step:

1. **Extract `identifier` (username or email) & password** from request.
2. **Find user** in DB (`$or` â†’ search by either email or username).
3. If **user not found** â†’ redirect with error âŒ.
4. **Compare password** using bcrypt.

   * If wrong â†’ send error âŒ.
5. **Generate JWT token** ğŸŸï¸.
6. **Save token in cookie** ğŸª.
7. Respond with **success** âœ….

ğŸ‘‰ This is the **login flow**.

---

# ğŸŒ Authentication Flow (Step by Step)

### ğŸ”µ Registration:

1. User opens `/auth/register` â†’ sees form.
2. Submits username, email, password.
3. Backend checks if user exists.
4. Password is hashed & saved in DB.
5. JWT token generated & sent as cookie.
6. User registered âœ….

### ğŸ”µ Login:

1. User opens `/auth/login` â†’ sees form.
2. Submits username/email + password.
3. Backend checks if user exists.
4. Password compared with hashed password.
5. JWT token generated & sent as cookie.
6. User logged in âœ….

---

# ğŸŒŸ Final Cheat-Sheet (with Emojis)

* ğŸ“ **getRegisterController** â†’ show register form.
* ğŸ“¥ **postRegisterController** â†’ save new user (with hashed password & JWT).
* ğŸ”‘ **getLoginController** â†’ show login form.
* ğŸ“¤ **postLoginController** â†’ check credentials, generate JWT, set cookie.
* ğŸ” **bcrypt** â†’ password hashing.
* ğŸŸï¸ **JWT** â†’ authentication token.
* ğŸª **res.cookie()** â†’ store token securely in browser.

---